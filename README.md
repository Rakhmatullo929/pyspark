# PySpark Product-Category Relationship Solution

**–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –Ω–∞ PySpark**

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–í PySpark –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞–º–∏ (`pyspark.sql.DataFrame`) –∑–∞–¥–∞–Ω—ã –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∏—Ö —Å–≤—è–∑–∏. –ö–∞–∂–¥–æ–º—É –ø—Ä–æ–¥—É–∫—Ç—É –º–æ–∂–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π. –ê –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–∂–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ. 

**–ó–∞–¥–∞—á–∞:** –ù–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç–æ–¥ –Ω–∞ PySpark, –∫–æ—Ç–æ—Ä—ã–π –≤ –æ–¥–Ω–æ–º –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ –≤–µ—Ä–Ω–µ—Ç:
- –í—Å–µ –ø–∞—Ä—ã ¬´–ò–º—è –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Äì –ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏¬ª
- –ò–º–µ–Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üéØ –†–µ—à–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–¥—Ö–æ–¥

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **LEFT JOIN** –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –¥–∞–∂–µ —Ç–µ—Ö, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

```python
def get_products_with_categories(self, products_df, categories_df, product_categories_df):
    # –®–∞–≥ 1: LEFT JOIN –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–æ —Å–≤—è–∑—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç-–∫–∞—Ç–µ–≥–æ—Ä–∏—è
    products_with_relations = products_df.alias("p") \
        .join(product_categories_df.alias("pc"), 
              col("p.product_id") == col("pc.product_id"), "left")
    
    # –®–∞–≥ 2: LEFT JOIN —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    result_df = products_with_relations.alias("pr") \
        .join(categories_df.alias("c"), 
              col("pr.category_id") == col("c.category_id"), "left") \
        .select(col("pr.product_name").alias("product_name"),
                col("c.category_name").alias("category_name"))
    
    return result_df
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–æ–¥—É–∫—Ç—ã (products_df)
| product_id | product_name |
|------------|--------------|
| 1 | iPhone 14 |
| 2 | MacBook Pro |
| ... | ... |

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (categories_df)
| category_id | category_name |
|-------------|---------------|
| 1 | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã |
| 2 | –ù–æ—É—Ç–±—É–∫–∏ |
| ... | ... |

#### –°–≤—è–∑–∏ (product_categories_df)
| product_id | category_id |
|------------|-------------|
| 1 | 1 |
| 1 | 3 |
| ... | ... |

### –†–µ–∑—É–ª—å—Ç–∞—Ç
| product_name | category_name |
|--------------|---------------|
| iPhone 14 | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã |
| iPhone 14 | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ |
| MacBook Pro | –ù–æ—É—Ç–±—É–∫–∏ |
| MacBook Pro | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ |
| –ü—Ä–æ–¥—É–∫—Ç –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | NULL |

## üöÄ –ó–∞–ø—É—Å–∫ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

```bash
python pyspark_product_category_solution.py
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest test_pyspark_solution.py -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest test_pyspark_solution.py::TestProductCategoryProcessor::test_products_without_categories_included -v
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ Java 17+
export JAVA_HOME=/opt/homebrew/opt/openjdk@17  # macOS —Å Homebrew
export PATH="$JAVA_HOME/bin:$PATH"
java -version  # –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å Java 17+
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ pyspark_product_category_solution.py  # –û—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ test_pyspark_solution.py             # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt                      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                            # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

- ‚úÖ **–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
- ‚úÖ **–ü—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å NULL –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- ‚úÖ **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –†–∞–±–æ—Ç–∞ —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞–º–∏
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üí° –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü–æ–ª–Ω–æ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- **–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã**: –î–∞–∂–µ –ø—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–í—Å–µ —Å–≤—è–∑–∏ —É—á—Ç–µ–Ω—ã**: –ü—Ä–æ–¥—É–∫—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JOIN'—ã**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LEFT JOIN –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–ª–∏–∞—Å—ã**: –ò–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω —Å—Ç–æ–ª–±—Ü–æ–≤
- **Spark –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: –í–∫–ª—é—á–µ–Ω–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã**: –Ø–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### 4. –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞
- **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã
- **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ**: –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ PEP 8



## üìä –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

### SQL –ø–æ–¥—Ö–æ–¥
```sql
SELECT 
    p.product_name,
    c.category_name
FROM products p
LEFT JOIN product_categories pc ON p.product_id = pc.product_id
LEFT JOIN categories c ON pc.category_id = c.category_id
```

### DataFrame API –ø–æ–¥—Ö–æ–¥ (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
```python
result_df = products_df.alias("p") \
    .join(product_categories_df.alias("pc"), 
          col("p.product_id") == col("pc.product_id"), "left") \
    .join(categories_df.alias("c"), 
          col("pc.category_id") == col("c.category_id"), "left") \
    .select(col("p.product_name"), col("c.category_name"))
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SQL –ø–æ–¥—Ö–æ–¥–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
```python
# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å DataFrame'—ã –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
products_df.createOrReplaceTempView("products")
categories_df.createOrReplaceTempView("categories")
product_categories_df.createOrReplaceTempView("product_categories")

# –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å
result_df = spark.sql("""
    SELECT p.product_name, c.category_name
    FROM products p
    LEFT JOIN product_categories pc ON p.product_id = pc.product_id
    LEFT JOIN categories c ON pc.category_id = c.category_id
""")
```

---

**–†–µ—à–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º**
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** PySpark ‚Ä¢ Python ‚Ä¢ SQL ‚Ä¢ Apache Spark 